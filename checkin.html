<script>
document.getElementById("namaDisplay").innerText = localStorage.getItem("nama") || "Guest";

function getFormattedTime() {
  const now = new Date();
  const options = {
    year: 'numeric', month: 'long', day: 'numeric',
    hour: 'numeric', minute: 'numeric', second: 'numeric',
    hour12: true,
    timeZone: 'Asia/Kuala_Lumpur'
  };
  return now.toLocaleString('en-US', options);
}

function sendData(action) {
  const nama = localStorage.getItem("nama");
  const staffid = localStorage.getItem("staffid");
  if (!nama || !staffid) {
    alert("Missing login details!");
    return;
  }

  if (!navigator.geolocation) {
    alert("Geolocation is not supported by your browser.");
    return;
  }

  navigator.geolocation.getCurrentPosition(position => {
    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
    const timestamp = getFormattedTime();

    const bodyData = { nama, staffid, action, timestamp, latitude, longitude };

    fetch("https://api.sheetbest.com/sheets/a34b2f38-cd4d-4b91-8306-30b3daa64be7", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(bodyData)
    })
    .then(response => {
      if (response.ok) {
        document.getElementById("message").innerHTML = `âœ… ${action} Successful!<br>Time: ${timestamp}`;
      } else {
        alert("Failed to record " + action);
      }
    })
    .catch(error => {
      alert("Error connecting to server.");
      console.error(error);
    });

  }, () => {
    alert("Unable to retrieve your location");
  });
}

function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}
</script>
