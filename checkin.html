<script>
  // Check kalau tiada localStorage nama (bukan staff)
  if (!localStorage.getItem("nama")) {
    window.location.href = "login.html";
  }

  document.getElementById("namaDisplay").innerText = localStorage.getItem("nama") || "Guest";

  function sendData(action) {
    const nama = localStorage.getItem("nama");
    const staffid = localStorage.getItem("staffid");
    if (!nama || !staffid) {
      alert("Missing login details!");
      window.location.href = "login.html";
      return;
    }

    const timestamp = new Date().toISOString();
    const bodyData = {
      nama: nama,
      staffid: staffid,
      action: action,
      timestamp: timestamp
    };

    fetch("https://api.sheetbest.com/sheets/a34b2f38-cd4d-4b91-8306-30b3daa64be7", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(bodyData)
    })
    .then(response => {
      if (response.ok) {
        document.getElementById("message").innerHTML = `âœ… ${action} Successful!<br>Time: ${new Date().toLocaleString()}`;
      } else {
        alert("Failed to record " + action);
      }
    })
    .catch(error => {
      alert("Error connecting to server.");
      console.error(error);
    });
  }
</script>
